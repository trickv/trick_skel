#!/usr/bin/env bash

dryrun="--dry-run"

if [ "$1" = "--real" ]; then
    echo "Actually committing changes!"
    sleep 5
    dryrun=""
else
    echo "Dry run..."
fi

if [ "$HOSTNAME" == "atlas" ]; then
    echo "Limiting bandwidth to 1000 kb/sec because this is atlas"
    bwlimit="--bwlimit 1000"
fi

rsync --exclude=".timestamp-hourly" $bwlimit --archive --verbose  --partial --delete-after --progress $dryrun $HOME/Music/ rsync://mc/music/
if [ "$dryrun" == "" ]; then
    echo "Signaling mpd database update"
    ssh mc "mpc update"
fi
