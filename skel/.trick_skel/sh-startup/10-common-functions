# Keychain automagicalness
trick_skel_start_keychain () {
    TRICK_KEYCHAIN=`which keychain 2> /dev/null`
    if [ $? -eq 0 ]; then
        # we have keychain

        # quick check to ensure we're not already starting keychain
        egrep '^keychain' $HOME/.bash_profile &> /dev/null
        if [ $? -ne 1 ]; then
            echo "Refusing to run keychain as it seems to be in this bash_profile already."
            return
        fi

        # find keys and load them in
        TRICK_KEYS=`find $HOME/.ssh/ -name "*id_?sa" | grep -v backup | grep -v old`
        if [ "$TRICK_KEYS" != "" ]; then
            for cur in $TRICK_KEYS; do
                $TRICK_KEYCHAIN -q --nogui $cur
            done
            . $HOME/.keychain/`hostname`-sh
        else
            echo "No keys!"
        fi
    fi
    unset TRICK_KEYCHAIN TRICK_KEYS cur
}

trick_skel_first_ssh_run () {
    trick_skel_start_keychain
    unalias ssh
    ssh $@
}

trick_skel_verify_ssh_agent () {
    ps auxwww | grep ^$USER | grep -v grep | grep ssh-agent &> /dev/null
    if [ $? -ne 0 ]; then
        echo "Notice: ssh-agent not running yet."
        alias ssh=trick_skel_first_ssh_run
    else
        trick_skel_start_keychain
    fi
}

# change up a bunch of directories at once
up () {
    if [ "$1" = "" ]; then
        UP_DIRS=1
    else
        UP_DIRS=$1
    fi

    for (( i = 1; i <= $UP_DIRS; i += 1 )); do
        cd ..
    done
}

# If this looks like a Mintel host, returns true
trick_skel_mintel () {
    hostname | egrep "(mintel.ad|mintel.co.uk|usdmm.com)$" &> /dev/null
    return $?
}

# vim:filetype=sh
